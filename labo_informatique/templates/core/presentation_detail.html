{% extends 'base.html' %}
{% load static %}
{% block title %}{{ presentation.titre }} - Beta Lab Laboratory{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static "css/presentation_detail.css" %} ">
{% endblock %}

{% block header_content %}
<div class="page-header animated-gradient">
    <h1 class="page-title fade-in">Presentation</h1>
    <div class="header-line"></div>
    

    <div class="page-title">
        <h1>{{ presentation.titre }}</h1>
        <p>{{ presentation.theme.nom }}</p>

    </div>
    <p class="page-subtitle fade-in delay-200">computer science research and technological innovations</p>
</div>
{% endblock %}

{% block content %}
<section class="presentation-detail">
    <div class="container">
        <div class="presentation-meta">
            <div class="meta-item">
                <i class="far fa-calendar-alt"></i>
                <span>Published on {{ presentation.date_creation|date:"d F Y" }}</span>
            </div>
            <div class="meta-item">
                <i class="far fa-user"></i>
                <span>By <a href="{% url 'labo:membre_detail' presentation.membre.id %}">{{ presentation.membre.user.first_name }} {{ presentation.membre.user.last_name }}</a></span>
            </div>
            <div class="meta-item">
                <i class="fas fa-tag"></i>
                <span>{{ presentation.theme.nom }}</span>
            </div>
            {% if peut_voir_fichier %}
            <div class="meta-item">
                {% if presentation.type_fichier == 'pdf' %}
                    <i class="far fa-file-pdf"></i>
                {% elif presentation.type_fichier == 'pptx' %}
                    <i class="far fa-file-powerpoint"></i>
                {% else %}
                    <i class="far fa-file"></i>
                {% endif %}
                <span>{{ presentation.type_fichier|upper }}</span>
            </div>
            {% endif %}
        </div>
        
        <div class="presentation-content-wrapper">
            <div class="presentation-desc">
                <h2>Description</h2>
                <div class="description-content">
                    {{ presentation.description|linebreaks }}
                </div>
            </div>
            
            <!-- Section fichier - TOUS types de fichiers - seulement si autorisÃ© -->
            {% if peut_voir_fichier %}
                {% if presentation.type_fichier == 'pdf' %}
                <div class="presentation-viewer">
                    <h2>Document preview</h2>
                    <div class="pdf-embed">
                        <object data="{{ presentation.fichier.url }}" type="application/pdf" width="100%" height="600">
                            <p>Your browser does not support embedded PDF display. <a href="{{ presentation.fichier.url }}" target="_blank">Click here to download the file</a>.</p>
                        </object>
                    </div>
                </div>
                {% else %}
                <div class="presentation-download">
                    <h2>Download document</h2>
                    <a href="{{ presentation.fichier.url }}" class="btn-download" target="_blank">
                        <i class="fas fa-download"></i> Download {{ presentation.type_fichier|upper }} file
                    </a>
                    <p class="download-note">To view this document, you will need software compatible with {{ presentation.type_fichier|upper }} format.</p>
                </div>
                {% endif %}
            {% else %}
                <!-- Message informatif seulement pour l'auteur -->
                {% if user.is_authenticated and user == presentation.membre.user %}
                    <div class="presentation-private-notice">
                        <h2>Document (Private)</h2>
                        <div class="alert alert-warning">
                            <i class="fas fa-eye-slash"></i>
                            Your file is private and not visible to the public. Only administrators can make it public.
                        </div>
                    </div>
                {% endif %}
            {% endif %}
            
            {% if images %}
            <div class="presentation-images">
                <h2>Presentation images</h2>
                <div class="images-gallery">
                    {% for image in images %}
                    <div class="gallery-item">
                        <img src="{{ image.image.url }}" alt="{{ image.legende }}" class="gallery-image">
                        {% if image.legende %}
                        <div class="image-caption">
                            <p>{{ image.legende }}</p>
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>
        
        <div class="presentation-author-info">
            <h2>About the author</h2>
            <div class="author-card">
                <div class="author-image">
                    {% if presentation.membre.photo %}
                        <img src="{{ presentation.membre.photo.url }}" alt="{{ presentation.membre.user.first_name }} {{ presentation.membre.user.last_name }}">
                    {% else %}
                        <div class="default-avatar">{{ presentation.membre.user.first_name|first }}{{ presentation.membre.user.last_name|first }}</div>
                    {% endif %}
                </div>
                <div class="author-content">
                    <h3>{{ presentation.membre.user.first_name }} {{ presentation.membre.user.last_name }}</h3>
                    <p class="author-title">{{ presentation.membre.titre }}</p>
                    <p class="author-bio">{{ presentation.membre.bio|truncatechars:200 }}</p>
                    <a href="{% url 'labo:membre_detail' presentation.membre.id %}" class="btn-view-profile">View profile</a>
                </div>
            </div>
        </div>
        
        {% if related_presentations %}
        <div class="related-presentations">
            <h2>Similar presentations</h2>
            <div class="related-grid">
                {% for related in related_presentations %}
                <div class="related-card">
                    <div class="related-type">
                        {% if related.type_fichier == 'pdf' %}
                            <i class="far fa-file-pdf"></i>
                        {% elif related.type_fichier == 'pptx' %}
                            <i class="far fa-file-powerpoint"></i>
                        {% else %}
                            <i class="far fa-file"></i>
                        {% endif %}
                    </div>
                    <div class="related-info">
                        <h3>{{ related.titre }}</h3>
                        <p class="related-author">
                            <span>By {{ related.membre.user.first_name }} {{ related.membre.user.last_name }}</span>
                            <span class="related-date">{{ related.date_creation|date:"d F Y" }}</span>
                        </p>
                    </div>
                    <a href="{% url 'labo:presentation_detail' related.id %}" class="related-link"></a>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script src="{% static "js/presentation_detail.js" %} "></script>
{% endblock %}