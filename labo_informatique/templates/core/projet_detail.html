{% extends 'base.html' %}
{% load static %}

{% block title %}{{ projet.titre }} - Beta Lab{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/projets1.css' %}">
{% endblock %}

{% block header_content %}
<div class="page-header animated-gradient">
    <div class="container">
        <div class="project-header-content">
            <div class="project-header-text">
                <div class="breadcrumb">
                    <a href="{% url 'labo:liste_projets' %}">Projects</a>
                    <span><i class="fas fa-chevron-right"></i></span>
                    <span>{{ projet.titre }}</span>
                </div>
                <h1 class="page-title fade-in">{{ projet.titre }}</h1>
                <div class="project-header-meta fade-in delay-200">
                    <div class="project-status-header status-{{ projet.statut }}">
                        {% if projet.statut == 'en_cours' %}
                            <i class="fas fa-play"></i> In Progress
                        {% elif projet.statut == 'termine' %}
                            <i class="fas fa-check"></i> Completed
                        {% elif projet.statut == 'suspendu' %}
                            <i class="fas fa-pause"></i> Suspended
                        {% elif projet.statut == 'annule' %}
                            <i class="fas fa-times"></i> Cancelled
                        {% endif %}
                    </div>
                    <div class="project-theme-header">{{ projet.theme.nom }}</div>
                </div>
            </div>
            
            {% if projet.image_principale %}
            <div class="project-header-image fade-in delay-400">
                <img src="{{ projet.image_principale.url }}" alt="{{ projet.titre }}">
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block content %}
<section class="project-detail-section">
    <div class="container">
        <div class="project-detail-grid">
            <!-- Contenu principal -->
            <div class="project-main-content">
                <!-- Description -->
                <div class="content-card">
                    <h2 class="card-title">
                        <i class="fas fa-info-circle"></i> Project description
                    </h2>
                    <div class="project-description-full">
                        {{ projet.description|linebreaks }}
                    </div>
                </div>
                
                <!-- Ã‰quipe -->
                <div class="content-card">
                    <h2 class="card-title">
                        <i class="fas fa-users"></i> Project team
                    </h2>
                    
                    <!-- Responsable -->
                    
                    <!-- Participants -->
                    {% if projet.participants.all %}
                    <div class="team-section">
                        <h3 class="team-subtitle">Participants ({{ projet.participants.count }})</h3>
                        <div class="team-grid">
                            {% for participant in projet.participants.all %}
                                <div class="team-member participant">
                                    <div class="member-avatar">
                                        {% if participant.photo %}
                                            <img src="{{ participant.photo.url }}" alt="{{ participant.user.first_name }}">
                                        {% else %}
                                            <div class="avatar-placeholder">
                                                {{ participant.user.first_name|first }}{{ participant.user.last_name|first }}
                                            </div>
                                        {% endif %}
                                    </div>
                                    <div class="member-info">
                                        <h4>{{ participant.user.first_name }} {{ participant.user.last_name }}</h4>
                                        <p class="member-title">{{ participant.titre }}</p>
                                        <a href="{% url 'labo:membre_detail' participant.id %}" class="member-link">
                                            <i class="fas fa-user"></i> Profile
                                        </a>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                    
                    <!-- Collaborateurs externes -->
                    {% if projet.collaborateurs_externes.all %}
                    <div class="team-section">
                        <h3 class="team-subtitle">External collaborators ({{ projet.collaborateurs_externes.count }})</h3>
                        <div class="team-grid">
                            {% for collaborateur in projet.collaborateurs_externes.all %}
                                <div class="team-member collaborateur">
                                    <div class="member-avatar">
                                        {% if collaborateur.photo %}
                                            <img src="{{ collaborateur.photo.url }}" alt="{{ collaborateur.prenom }}">
                                        {% else %}
                                            <div class="avatar-placeholder">
                                                {{ collaborateur.prenom|first }}{{ collaborateur.nom|first }}
                                            </div>
                                        {% endif %}
                                        <div class="member-role-badge external">External</div>
                                    </div>
                                    <div class="member-info">
                                        <h4>{{ collaborateur.prenom }} {{ collaborateur.nom }}</h4>
                                        <p class="member-title">{{ collaborateur.titre }}</p>
                                        <p class="member-institution">{{ collaborateur.institution }}</p>
                                        {% if collaborateur.lien %}
                                            <a href="{{ collaborateur.lien }}" target="_blank" class="member-link">
                                                <i class="fas fa-external-link-alt"></i> Profile
                                            </a>
                                        {% endif %}
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Sidebar -->
            <div class="project-sidebar">
                <!-- Informations rapides -->
                <div class="sidebar-card">
                    <h3 class="sidebar-title">Information</h3>
                    <div class="info-list">
                        <div class="info-item">
                            <div class="info-label">
                                <i class="fas fa-calendar-alt"></i> Start
                            </div>
                            <div class="info-value">{{ projet.date_debut|date:"d F Y" }}</div>
                        </div>
                        
                        <div class="info-item">
                            <div class="info-label">
                                <i class="fas fa-lightbulb"></i> Research theme
                            </div>
                            <div class="info-value">{{ projet.theme.nom }}</div>
                        </div>
                        
                        <div class="info-item">
                            <div class="info-label">
                                <i class="fas fa-info-circle"></i> Status
                            </div>
                            <div class="info-value">
                                <span class="status-badge status-{{ projet.statut }}">
                                    {{ projet.get_statut_display }}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Section projets similaires -->
{% if projets_similaires %}
<section class="related-projects-section">
    <div class="container">
        <h2 class="section-title">
            <span class="title-icon"><i class="fas fa-project-diagram"></i></span>
            Similar projects (same research theme)
        </h2>
        
        <div class="projects-grid">
            {% for projet_similaire in projets_similaires %}
                <div class="project-card related-project">
                    <div class="project-image">
                        {% if projet_similaire.image_principale %}
                            <img src="{{ projet_similaire.image_principale.url }}" alt="{{ projet_similaire.titre }}">
                        {% else %}
                            <div class="default-image">
                                <i class="fas fa-project-diagram"></i>
                            </div>
                        {% endif %}
                        <div class="project-status status-{{ projet_similaire.statut }}">
                            {{ projet_similaire.get_statut_display }}
                        </div>
                    </div>
                    
                    <div class="project-content">
                        <div class="project-header">
                            <h3 class="project-title">{{ projet_similaire.titre }}</h3>
                            <div class="project-theme">{{ projet_similaire.theme.nom }}</div>
                        </div>
                        
                        <p class="project-description">{{ projet_similaire.description|truncatechars:120 }}</p>
                        
                        <div class="project-actions">
                            <a href="{% url 'labo:projet_detail' projet_similaire.id %}" class="btn-project-detail">
                                View details <i class="fas fa-arrow-right"></i>
                            </a>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}
{% endblock %}